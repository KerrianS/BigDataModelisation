{
  "id": null,
  "uid": "crypto_dashboard",
  "title": "Crypto BIG DATA Dashboard",
  "tags": ["airflow", "crypto", "bigdata"],
  "timezone": "browser",
  "templating": {
    "list": [
      {
        "name": "symbol",
        "type": "query",
        "datasource": { "type": "postgres", "uid": "PostgreSQL" },
        "definition": "SELECT DISTINCT symbol FROM crypto_prices ORDER BY symbol",
        "query": "SELECT DISTINCT symbol FROM crypto_prices ORDER BY symbol",
        "refresh": 1,
        "multi": true,
        "includeAll": true,
        "allValue": ".*",
        "options": [],
        "current": {},
        "sort": 1
      }
    ]
  },
  "panels": [
    {
      "id": 6,
      "title": "Current Price: $symbol",
      "type": "stat",
      "datasource": { "type": "postgres", "uid": "PostgreSQL" },
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 5 },
      "targets": [
        {
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT price_usd, symbol FROM crypto_prices WHERE symbol IN ($symbol) AND ingestion_timestamp = (SELECT MAX(ingestion_timestamp) FROM crypto_prices) ORDER BY symbol ASC",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null }
            ]
          },
          "unit": "currencyUSD"
        }
      },
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "value_and_name"
      }
    },
    {
      "id": 5,
      "title": "Price History: $symbol",
      "type": "timeseries",
      "datasource": { "type": "postgres", "uid": "PostgreSQL" },
      "gridPos": { "x": 0, "y": 5, "w": 24, "h": 10 },
      "targets": [
        {
          "format": "time_series",
          "rawQuery": true,
          "rawSql": "SELECT ingestion_timestamp AS time, price_usd AS value, symbol as metric FROM crypto_prices WHERE symbol IN ($symbol) AND $__timeFilter(ingestion_timestamp) ORDER BY time ASC",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "drawStyle": "line",
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "fillOpacity": 15,
            "gradientMode": "area",
            "showPoints": "never"
          },
          "color": { "mode": "palette-classic" },
          "unit": "currencyUSD"
        }
      }
    },
    {
      "id": 1,
      "title": "Market Dominance (Top 5)",
      "type": "piechart",
      "datasource": { "type": "postgres", "uid": "PostgreSQL" },
      "gridPos": { "x": 0, "y": 10, "w": 8, "h": 8 },
      "targets": [
        {
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT name, market_cap_usd FROM crypto_prices WHERE ingestion_timestamp = (SELECT MAX(ingestion_timestamp) FROM crypto_prices) ORDER BY market_cap_usd DESC LIMIT 5",
          "refId": "A"
        }
      ]
    },
    {
      "id": 3,
      "title": "Top Gainers (24h)",
      "type": "bargauge",
      "datasource": { "type": "postgres", "uid": "PostgreSQL" },
      "gridPos": { "x": 8, "y": 10, "w": 8, "h": 8 },
      "targets": [
        {
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT name, change_percent_24h FROM crypto_prices WHERE ingestion_timestamp = (SELECT MAX(ingestion_timestamp) FROM crypto_prices) ORDER BY change_percent_24h DESC LIMIT 5",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": 0 }
            ]
          },
          "unit": "percent"
        }
      }
    },
    {
      "id": 4,
      "title": "Top Losers (24h)",
      "type": "bargauge",
      "datasource": { "type": "postgres", "uid": "PostgreSQL" },
      "gridPos": { "x": 16, "y": 10, "w": 8, "h": 8 },
      "targets": [
        {
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT name, change_percent_24h FROM crypto_prices WHERE ingestion_timestamp = (SELECT MAX(ingestion_timestamp) FROM crypto_prices) ORDER BY change_percent_24h ASC LIMIT 5",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": -100 },
              { "color": "green", "value": 0 }
            ]
          },
          "unit": "percent"
        }
      }
    },
    {
      "id": 2,
      "title": "Market Overview (Top 100)",
      "type": "table",
      "datasource": { "type": "postgres", "uid": "PostgreSQL" },
      "gridPos": { "x": 0, "y": 18, "w": 24, "h": 16 },
      "targets": [
        {
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT rank, name, symbol, price_usd, high_24h, low_24h, ath, ath_change_percentage, market_cap_usd, volume_24h_usd, change_percent_24h FROM crypto_prices WHERE ingestion_timestamp = (SELECT MAX(ingestion_timestamp) FROM crypto_prices) ORDER BY rank ASC",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "displayMode": "auto"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null }
            ]
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "symbol" },
            "properties": [
              {
                "id": "links",
                "value": [
                  {
                    "title": "View History",
                    "url": "/d/${__dashboard.uid}/${__dashboard.slug}?var-symbol=${__data.fields.symbol}&from=now-3h&to=now"
                  }
                ]
              }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "change_percent_24h" },
            "properties": [
              {
                "id": "custom.displayMode",
                "value": "color-text"
              },
              {
                 "id": "thresholds",
                 "value": {
                   "mode": "absolute",
                   "steps": [
                     { "color": "red", "value": -100 },
                     { "color": "green", "value": 0 }
                   ]
                 }
              },
              {
                  "id": "unit",
                  "value": "percent"
              }
            ]
          },
          {
              "matcher": { "id": "byName", "options": "ath_change_percentage" },
              "properties": [
                {
                    "id": "unit",
                    "value": "percent"
                },
                {
                  "id": "custom.displayMode",
                  "value": "basic"
                }
              ]
          },
          {
            "matcher": { "id": "byName", "options": "price_usd" },
            "properties": [ { "id": "unit", "value": "currencyUSD" } ]
          },
          {
              "matcher": { "id": "byName", "options": "high_24h" },
              "properties": [ { "id": "unit", "value": "currencyUSD" } ]
          },
          {
              "matcher": { "id": "byName", "options": "low_24h" },
              "properties": [ { "id": "unit", "value": "currencyUSD" } ]
          },
          {
              "matcher": { "id": "byName", "options": "ath" },
              "properties": [ { "id": "unit", "value": "currencyUSD" } ]
          },
          {
            "matcher": { "id": "byName", "options": "market_cap_usd" },
             "properties": [ { "id": "unit", "value": "currencyUSD" } ]
          },
          {
              "matcher": { "id": "byName", "options": "volume_24h_usd" },
               "properties": [ { "id": "unit", "value": "currencyUSD" } ]
          }
        ]
      }
    }
  ],
  "refresh": "10s"
}
